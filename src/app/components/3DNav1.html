"use client";

import { Canvas } from "@react-three/fiber";
import { Stars } from "@react-three/drei";
import * as THREE from "three";
import { useEffect, useState } from "react";

function CameraController() {
  const [scrollY, setScrollY] = useState(0);

  useEffect(() => {
    const handleScroll = () => setScrollY(window.scrollY);
    window.addEventListener("scroll", handleScroll);
    return () => window.removeEventListener("scroll", handleScroll);
  }, []);

  return (
    <primitive
      object={{
        updateMatrixWorld: () => {},
        onUpdate: (camera) => {
         camera.position.z = Math.min(20, 10 + scrollY / 100);

          camera.lookAt(0, 0, 0);
        },
      }}
    />
  );
}

function FloatingSection({ position }) {
  return (
    <mesh position={position}>
      <boxGeometry args={[3, 1.5, 0.5]} />
      <meshStandardMaterial color="orange" />
    </mesh>
  );
}

function GalaxyPoints() {
  const positions = [];
  for (let i = 0; i < 2000; i++) {
    const angle = Math.random() * Math.PI * 2;
    const radius = Math.sqrt(Math.random()) * 60;
    const spiral = radius * 0.4;
    const x = Math.cos(angle) * radius;
    const y = (Math.random() - 0.5) * 30;
    const z = Math.sin(angle) * radius + spiral;
    positions.push(x, y, z);
  }

  const buffer = new THREE.BufferGeometry();
  buffer.setAttribute("position", new THREE.Float32BufferAttribute(positions, 3));

  return (
    <points geometry={buffer}>
      <pointsMaterial color="#88ccff" size={0.6} opacity={0.7} transparent />
    </points>
  );
}

export default function GalaxyLandingPage() {
  return (
    <div style={{ width: "100vw", height: "300vh", background: "black" }}>
      <Canvas camera={{ position: [0, 0, 10], fov: 60 }}>
        <ambientLight intensity={0.5} />
        <pointLight position={[10, 10, 10]} intensity={2} />
        <GalaxyPoints />
        <Stars radius={100} depth={50} count={3000} factor={4} />
        <CameraController />
        <FloatingSection position={[0, 0, 0]} />
        <FloatingSection position={[0, -5, 0]} />
        <FloatingSection position={[0, -10, 0]} />
      </Canvas>
    </div>
  );
}
